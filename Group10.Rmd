---
title: "Project - Group 10"
author: "Anthony Desdha, Santiago Fonnegra, Tim Haynes, Hayden Post, Vyvy Tran, Valeria Valle, Katie Yang"
date: "SDS 322E"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("MASS")
```

```{r message=FALSE}

library(tidyverse)

# select data Water_Quality <- read.csv("Water_Quality.csv")

Water_Quality <- read.csv("~/Water_Quality.csv", header=FALSE)

# Change the names of the variables to their retrospective column names 
col_names <- Water_Quality[1, ]
colnames(Water_Quality) <- col_names

# Remove the first row
Water_Quality_new <- Water_Quality[-1, ]

# Separate the month, day, year, time and meridium
Water_Quality_new <- Water_Quality_new %>% separate(SAMPLE_DATE, into = c("Date", "Time", "Meridium"), sep = " ")
Water_Quality_new <- Water_Quality_new %>% separate(Date, into = c("Month", "Day", "Year"), sep = "/") 

# Change the NA and long column names into specific column names 
colnames(Water_Quality_new)[colnames(Water_Quality_new) == "NA"] <- "ID"
colnames(Water_Quality_new)[colnames(Water_Quality_new) == "LAT_DD_WGS84"] <- "Latitude"
colnames(Water_Quality_new)[colnames(Water_Quality_new) == "LON_DD_WGS84"] <- "Longitude"

```

## Description

**Analyzing the relationship between pathogenic bacteria and organic nutrients present in freshwater samples taken in Austin.**

## Goals

**Our goals for this project is to observe how different organic nutrients and different locations can affect E.coli presence. Additionally, we also want to be able to analyze a data set and create/conclude data visualizations and answer our hypothesis.**

## Link to Data

**https://drive.google.com/file/d/13872S6iGB2MThwLKrlwKPZ2B5RK_kt5j/view?usp=sharing**

## Information on the Data

**This is a subset of the larger dataset of Water Quality in different waters in Austin and the different nutrients found in them.**

```{r}
### Descriptive Stats - Missingness: Addressing NA's
library(MASS)

# Make RESULTS column numeric 
Water_Quality_new$RESULT <- as.numeric(Water_Quality_new$RESULT) 

# Percentage of completed graphs (How many rows are not NA's)
Water_Quality_new %>% summarize_all (function(x)mean (!is.na(x)))

# How many rows are missing for the RESULT column 
sum(is.na(Water_Quality_new$RESULT))

# Create a missingness indicator variable for RESULTS
Water_Quality_indicator <- Water_Quality_new %>%
  mutate(missing_variable_indicator = ifelse(is.na(RESULT), 1, 0))

# Filter out the rows that are not missings
Water_Quality_missing_rows <- Water_Quality_indicator %>%
  filter(missing_variable_indicator == 1)


# Visualize the amount of Project names that have any missingness in the RESULTS column
ggplot(Water_Quality_missing_rows, aes(x = PROJECT)) +
  geom_bar(stat = "count") +
  labs(title = "Missingness of RESULT vs. PROJECT",
       x = "Project name",
       y = "Latitide Missingness Count") +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Create a missingness indicator variable for Longitude
Water_Quality_indicator <- Water_Quality_new %>%
  mutate(missing_variable_indicator = ifelse(is.na(Longitude), 1, 0))

#Filter out the rows that are not missing
Water_Quality_missing_rows <- Water_Quality_indicator %>%
  filter(missing_variable_indicator == 1)


# Visualize the amount of Project names that have any missingness in the Longitude column
ggplot(Water_Quality_missing_rows, aes(x = PROJECT)) +
  geom_bar(stat = "count") +
  labs(title = "Missingness of Longitude vs. PROJECT",
       x = "Project Name",
       y = "Result Missingness Count") +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1))

### Decriptive Stats - E. Coli Concentrations
# Visualize the Ecoli concentrations
boxplot(Water_Quality_new$RESULT[Water_Quality_new$PARAMETER == "E COLI BACTERIA"], main="E. coli Concentration Boxplot")

### Visualize Ecoli concentration over the years
# Filter for rows where the parameter is Ecoli measured as colonies/100mL
ecoli_data <- Water_Quality_new[Water_Quality_new$UNIT == "Colonies/100mL", ]

# Fit a Huber regression model
huber_model <- rlm(RESULT ~ Year, data = Water_Quality_new)

# Create a scatter plot with the regression line
ggplot(ecoli_data, aes(x = Year, y = RESULT)) +
  geom_point(aes(color = "Observed"), alpha = 0.7) +
  geom_smooth(method = "rlm", formula = y ~ x, se = FALSE, color = "blue") +
  labs(title = "E. coli Amounts Over the Years (Colonies method)",
       x = "Year", y = "E. coli Concentration (Colonies/100mL)") +
  scale_color_manual(values = c("Observed" = "red")) +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

# Remove outliers 
# Create data vector with no NA's
ecoli_data_no_na <- subset(Water_Quality_new, UNIT == "Colonies/100mL" & !is.na(RESULT))

# Identify outliers using IQR method 
Q1 <- quantile(ecoli_data_no_na$RESULT, 0.25)
Q3 <- quantile(ecoli_data_no_na$RESULT, 0.75)
IQR <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

#Remove outliers
ecoli_data_no_outliers <- ecoli_data_no_na[ecoli_data_no_na$RESULT >= lower_bound & ecoli_data_no_na$RESULT <= upper_bound, ]

# Create a new plot without outliers (Colonies)
ggplot(ecoli_data_no_outliers, aes(x = Year, y = RESULT)) +
  geom_point(aes(color = "Observed"), alpha = 0.7) +
  geom_smooth(method = "rlm", formula = y ~ x, se = FALSE, color = "blue") +
  labs(title = "E. coli Amounts Over the Years (Colonies method) (No outliners)",
       x = "Year", y = "E. coli Concentration (Colonies/100mL)") +
  scale_color_manual(values = c("Observed" = "green")) +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")


### 
# Filter for rows where the parameter is Ecoli measured as MPN/100mL
ecoli_data_mpn <- Water_Quality_new[Water_Quality_new$UNIT == "MPN/100ML", ]

# Fit a Huber regression model
huber_model <- rlm(RESULT ~ Year, data = Water_Quality_new)


# Create a scatter plot with the regression line
ggplot(ecoli_data_mpn, aes(x = Year, y = RESULT)) +
  geom_point(aes(color = "Observed"), alpha = 0.7) +
  geom_smooth(method = "rlm", formula = y ~ x, se = FALSE, color = "blue") +
  labs(title = "E. coli Amounts Over the Years (MPN method)",
       x = "Year", y = "E. coli Concentration (MPN/100mL") +
  scale_color_manual(values = c("Observed" = "red")) +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

# Remove outliers 
# Create data vector with no NA's
ecoli_data_no_na_mpn <- subset(Water_Quality_new, UNIT == "MPN/100ML" & !is.na(RESULT))

# Identify outliers using IQR method 
Q1 <- quantile(ecoli_data_no_na_mpn$RESULT, 0.25)
Q3 <- quantile(ecoli_data_no_na_mpn$RESULT, 0.75)
IQR <- Q3 - Q1
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

# Remove outliers 
ecoli_data_no_outliers_mpn <- ecoli_data_no_na_mpn[ecoli_data_no_na_mpn$RESULT >= lower_bound & ecoli_data_no_na_mpn$RESULT <= upper_bound, ]

# Create a new plot without outliers (MPN)
ggplot(ecoli_data_no_outliers_mpn, aes(x = Year, y = RESULT)) +
  geom_point(aes(color = "Observed"), alpha = 0.7) +
  geom_smooth(method = "rlm", formula = y ~ x, se = FALSE, color = "blue") +
  labs(title = "E. coli Amounts Over the Years (MPN method) (No outliners)",
       x = "Year", y = "E. coli Concentration (Colonies/100mL)") +
  scale_color_manual(values = c("Observed" = "green")) +
  theme_minimal()+ theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
```

## Data Visualizations

```{r}
library(ggplot2)

# Visualization 1 Bar graph displaying Ecoli Presence by type of Watershed 

Water_Quality_new %>% group_by(PARAMETER)%>% filter(PARAMETER == "E COLI BACTERIA") %>% ggplot(aes(x=WATERSHED)) + geom_bar(alpha=1, size=2)+ theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) + labs(x = 'Watershed', y = 'E. Coli Presence')

#Visualization 2 Bar graph displaying Ecoli Presence by type of Site type 
Water_Quality_new %>% group_by(PARAMETER)%>% filter(PARAMETER == "E COLI BACTERIA") %>% ggplot(aes(x=SITE_TYPE)) + geom_bar(alpha=1, size=2)+ theme(axis.text.x = element_text(angle = 45, vjust = 0.7)) + labs(x = 'Site Type', y = 'E. Coli Presence')
```

```{r}
# Visualization 3 Geomap of Ecoli presence using Colonies 
# Call the ggmap package

library(ggmap)
library(dplyr)

# Apply a google key 
register_google(key = "AIzaSyDr6jqdF-_3E85ni2nNRcZJ46ieUYokTpk")

# Filter for only the rows containing Ecoli concentrations based on colonies/100ml
Water_Quality_ecoli <- Water_Quality_new %>%
  filter(PARAMETER == "E COLI BACTERIA", UNIT == "Colonies/100mL")

# Find out how much missingness in the longitude and latitude columns for the filtered data
Water_Quality_ecoli %>% summarize_all (function(x)mean (!is.na(x)))

# Remove NA's in columns for latitude, longitude and concentration
Water_Quality_ecoli <- na.omit(Water_Quality_ecoli[, c("Longitude", "Latitude", "RESULT")])

# Make variables numeric
Water_Quality_ecoli$Longitude <- as.numeric(Water_Quality_ecoli$Longitude)
Water_Quality_ecoli$Latitude <- as.numeric(Water_Quality_ecoli$Latitude)
Water_Quality_ecoli$RESULT <- as.numeric(Water_Quality_ecoli$RESULT) 

# Label the parameters of the map 
map_data <- Water_Quality_ecoli %>%
  summarise(lat_min = min(Latitude),
            lat_max = max(Latitude),
            lon_min = min(Longitude),
            lon_max = max(Longitude))

# Use the parameters to obtain a map using get_googlemap
map <- get_googlemap(center = c(lon = mean(c(map_data$lon_min, map_data$lon_max)), lat = mean(c(map_data$lat_min, map_data$lat_max))), zoom = 10)

# Using ggmap create a map based on Ecoli concentration using color gradient 
ggmap(map) +
  geom_point(data = Water_Quality_ecoli, aes(x = Longitude, y = Latitude, color = RESULT), size = 1) +
  scale_color_gradient(name = "Ecoli Concentration using Colonies/100mL", low = "green", high = "red") +
  labs(title = "Ecoli Concentration Map Colonies/100ml",
       x = "Longitude",  # Replace with your actual x variable label
       y = "Latitude") +
  theme_minimal()

```

```{r}
# Visualization 4 Geomap of Ecoli presence using MPN/100ML 

# Call the ggmap package
library(ggmap)
library(dplyr)

# Apply a google key 
register_google(key = "AIzaSyDr6jqdF-_3E85ni2nNRcZJ46ieUYokTpk")

# Filter for only the rows containing Ecoli concentrations based on MPN/100ML
Water_Quality_ecoli_mpn <- Water_Quality_new %>%
  filter(PARAMETER == "E COLI BACTERIA", UNIT == "MPN/100ML")

# Find out how much missingness in the longitude and latitude columns for the filtered data
Water_Quality_ecoli_mpn %>% summarize_all (function(x)mean (!is.na(x)))

# Remove NA's in columns for latitude, longitude and concentration
Water_Quality_ecoli_mpn <- na.omit(Water_Quality_ecoli_mpn[, c("Longitude", "Latitude", "RESULT")])

# Make variables numeric
Water_Quality_ecoli_mpn$Longitude <- as.numeric(Water_Quality_ecoli_mpn$Longitude)
Water_Quality_ecoli_mpn$Latitude <- as.numeric(Water_Quality_ecoli_mpn$Latitude)
Water_Quality_ecoli_mpn$RESULT <- as.numeric(Water_Quality_ecoli_mpn$RESULT) 

# Label the parameters of the map 
map_data <- Water_Quality_ecoli_mpn %>%
  summarise(lat_min = min(Latitude),
            lat_max = max(Latitude),
            lon_min = min(Longitude),
            lon_max = max(Longitude))

# Use the parameters to obtain a map using get_googlemap
map <- get_googlemap(center = c(lon = mean(c(map_data$lon_min, map_data$lon_max)), lat = mean(c(map_data$lat_min, map_data$lat_max))), zoom = 10)

# Using ggmap create a map based on Ecoli concentration using color gradient 
ggmap(map) +
  geom_point(data = Water_Quality_ecoli_mpn, aes(x = Longitude, y = Latitude, color = RESULT), size = 1) +
  scale_color_gradient(name = "Ecoli Concentration using MPN/100ML", low = "green", high = "red") +
  labs(title = "Ecoli Concentration Map MPN/100ML",
  x = "Longitude", 
  y = "Latitude") +
  theme_minimal()
```
```{r}
### New visualization of Ecoli presence using Colonies without outliers

# Call the ggmap package
library(ggmap)
library(dplyr)

# Make variables numeric
ecoli_data_no_outliers$Longitude <- as.numeric(ecoli_data_no_outliers$Longitude)
ecoli_data_no_outliers$Latitude <- as.numeric(ecoli_data_no_outliers$Latitude)
ecoli_data_no_outliers$RESULT <- as.numeric(ecoli_data_no_outliers$RESULT)

# Remove NA's in columns for latitude, longitude and concentration
ecoli_data_no_outliers <- na.omit(ecoli_data_no_outliers[, c("Longitude", "Latitude", "RESULT")])

# Label the parameters of the map 
map_data <- ecoli_data_no_outliers %>%
  summarise(lat_min = min(Latitude),
            lat_max = max(Latitude),
            lon_min = min(Longitude),
            lon_max = max(Longitude))

# Use the parameters to obtain a map using get_googlemap
map <- get_googlemap(center = c(lon = mean(c(map_data$lon_min, map_data$lon_max)), lat = mean(c(map_data$lat_min, map_data$lat_max))), zoom = 10)

# Using ggmap create a map based on Ecoli concentration using color gradient 
ggmap(map) +
  geom_point(data = ecoli_data_no_outliers, aes(x = Longitude, y = Latitude, color = RESULT), size = 1) +
  scale_color_gradient(name = "Ecoli Concentration using Colonies/100mL", low = "green", high = "red") +
  labs(title = "Ecoli Concentration Map Colonies/100ml",
       x = "Longitude",  # Replace with your actual x variable label
       y = "Latitude") +
  theme_minimal()

```

```{r}
### New visualization of Ecoli presence using MPN without outliers

# Call the ggmap package
library(ggmap)
library(dplyr)

# Make variables numeric
ecoli_data_no_outliers_mpn$Longitude <- as.numeric(ecoli_data_no_outliers_mpn$Longitude)
ecoli_data_no_outliers_mpn$Latitude <- as.numeric(ecoli_data_no_outliers_mpn$Latitude)
ecoli_data_no_outliers_mpn$RESULT <- as.numeric(ecoli_data_no_outliers_mpn$RESULT)

# Remove NA's in columns for latitude, longitude and concentration
ecoli_data_no_outliers_mpn <- na.omit(ecoli_data_no_outliers_mpn[, c("Longitude", "Latitude", "RESULT")])

# Label the parameters of the map 
map_data <- ecoli_data_no_outliers_mpn %>%
  summarise(lat_min = min(Latitude),
            lat_max = max(Latitude),
            lon_min = min(Longitude),
            lon_max = max(Longitude))

# Use the parameters to obtain a map using get_googlemap
map <- get_googlemap(center = c(lon = mean(c(map_data$lon_min, map_data$lon_max)), lat = mean(c(map_data$lat_min, map_data$lat_max))), zoom = 10)

# Using ggmap create a map based on Ecoli concentration using color gradient 
ggmap(map) +
  geom_point(data = ecoli_data_no_outliers_mpn, aes(x = Longitude, y = Latitude, color = RESULT), size = 1) +
  scale_color_gradient(name = "Ecoli Concentration using MPN/100mL", low = "green", high = "red") +
  labs(title = "Ecoli Concentration Map MPN/100ml",
       x = "Longitude",  # Replace with your actual x variable label
       y = "Latitude") +
  theme_minimal()
```


## Hypothesis

**1: Increasing human presence in public bodies of water will increase E. coli presence in popular attraction sites.  **

**2: If there is more running water in a particular body of water, then the presence of E. coli will increase.**

## References

**This data originally came from a larger data set describing the same variables. This originally data set is called "Water Quality Sampling Data" located on the data.austintexas.gov website.**
